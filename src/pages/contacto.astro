---
import Layout from '../layouts/Layout.astro';
import 'aos/dist/aos.css';
---

<Layout title="Contacto - Terapia Shalom">
  <main class="p-8 text-center pt-32">
    <h1 class="text-5xl font-bold mb-6 text-ts-accent" data-aos="fade-down" data-aos-delay="50">Contáctanos</h1>
    <p class="text-lg text-ts-text max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="100">
      ¿Tienes preguntas o quieres reservar? Estamos aquí para ayudarte. Rellena el formulario o contáctanos por WhatsApp.
    </p>
    <section class="max-w-xl mx-auto mt-10 p-8 bg-white rounded-lg shadow-md border border-ts-background/50" data-aos="fade-up" data-aos-delay="150">
      <h2 class="text-2xl font-semibold mb-6 text-ts-primary">Envíanos un Mensaje</h2>
      <form
        id="contact-form"
        class="space-y-4 text-left"
        method="POST"
      >
        <div>
          <label for="name" class="block text-ts-text text-sm font-medium mb-1">Nombre</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="mt-1 block w-full p-2 border border-ts-accent/40 rounded-md shadow-sm focus:ring-ts-primary focus:border-ts-primary sm:text-sm bg-ts-background/70 text-ts-text placeholder-ts-accent/60"
            placeholder="Tu Nombre"
          />
          <p class="text-xs text-red-600 mt-1 hidden" id="name-error">Por favor, ingresa tu nombre.</p>
        </div>
        <div>
          <label for="email" class="block text-ts-text text-sm font-medium mb-1">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="mt-1 block w-full p-2 border border-ts-accent/40 rounded-md shadow-sm focus:ring-ts-primary focus:border-ts-primary sm:text-sm bg-ts-background/70 text-ts-text placeholder-ts-accent/60"
            placeholder="tu.email@example.com"
          />
          <p class="text-xs text-red-600 mt-1 hidden" id="email-error">Por favor, ingresa un email válido.</p>
        </div>
        <div>
          <label for="message" class="block text-ts-text text-sm font-medium mb-1">Mensaje</label>
          <textarea
            id="message"
            name="message"
            rows="4"
            required
            class="mt-1 block w-full p-2 border border-ts-accent/40 rounded-md shadow-sm focus:ring-ts-primary focus:border-ts-primary sm:text-sm bg-ts-background/70 text-ts-text placeholder-ts-accent/60"
            placeholder="Escribe tu mensaje aquí..."
          ></textarea>
          <p class="text-xs text-red-600 mt-1 hidden" id="message-error">Por favor, escribe tu mensaje.</p>
        </div>
        <button
          type="submit"
          class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-ts-primary hover:bg-ts-accent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-ts-primary transition duration-300 mt-4"
        >
          Enviar Mensaje
        </button>
      </form>
      <div id="success-message" class="hidden mt-4 text-ts-primary text-center font-semibold">
        ¡Tu mensaje ha sido enviado correctamente!
      </div>
    </section>

    <script is:inline>
    document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contact-form');
    const successMessage = document.getElementById('success-message');

    form.addEventListener('submit', async function (e) {
      e.preventDefault(); // Prevenir envío tradicional

      let valid = true;

      // Validación Nombre
      const name = form.elements['name'];
      const nameError = document.getElementById('name-error');
      if (!name.value.trim()) {
        nameError.classList.remove('hidden');
        valid = false;
      } else {
        nameError.classList.add('hidden');  
      }

      // Validación Email
      const email = form.elements['email'];
      const emailError = document.getElementById('email-error');
      const emailPattern = /^[^@]+@[^@]+\.[a-zA-Z]{2,}$/;
      if (!email.value.trim() || !emailPattern.test(email.value)) {
        emailError.classList.remove('hidden');
        valid = false;
      } else {
        emailError.classList.add('hidden');
      }

      // Validación Mensaje
      const message = form.elements['message'];
      const messageError = document.getElementById('message-error');
      if (!message.value.trim()) {
        messageError.classList.remove('hidden');
        valid = false;
      } else {
        messageError.classList.add('hidden');
      }

      if (!valid) {
        successMessage.classList.add('hidden');
        return;
      }

      // Enviar datos a Formspree sin recargar
      try {
        const response = await fetch("https://formspree.io/f/movwvdbo", {
          method: "POST",
          headers: {
            "Accept": "application/json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            name: name.value,
            email: email.value,
            message: message.value
          })
        });

        if (response.ok) {
          form.reset();
          successMessage.classList.remove('hidden');
          setTimeout(() => {
            successMessage.classList.add('hidden');
          }, 5000);
        } else {
          alert("Error al enviar el formulario. Inténtalo nuevamente.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("Ocurrió un error inesperado.");
      }
    });
  });
</script>


    
    <script>
      import AOS from 'aos';
      AOS.init({
        duration: 800,
        easing: 'ease-in-out',
        once: false, // Permite repetir la animación
      });
      AOS.refresh();
    </script>
  </main>
</Layout>